
taha@HP-Probook:~/Documents/Projects/Aeroscraper/aerospacer-solana$ ANCHOR_PROVIDER_URL=https://api.devnet.solana.com \
ANCHOR_WALLET=~/.config/solana/id.json \
npx ts-mocha -p ./tsconfig.json -t 1000000 'tests/**/protocol-core.ts'
USER1: GLThBB9YBHJgQMVj2wGpbLwKwEMfjr1ieVHaqgueYxUn
USER2: H6jcCMEZJvBsyd16VizDF9E6aosUpzuTvjuhk1JWWavw
(node:1436742) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/tests/protocol-core.ts is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)


  Aeroscraper Protocol Core Operations
Using existing stablecoin mint: GnasBgv2aBS97fUDGXGcseCQcXT9tGoKG9R49SDDyMMM
‚úÖ Using existing devnet collateral mint from vault: Hygyfy8RBxLvoz5b3ffsg9PAvEkT3BJXXdTpVu6ftZYz
Creating admin stablecoin account...
Admin public key: 5oMxbgjPWkBYRKbsh3yKrrEC5Ut8y3azHKc787YHY9Ar
Stablecoin mint: GnasBgv2aBS97fUDGXGcseCQcXT9tGoKG9R49SDDyMMM
Admin stablecoin account already exists, skipping creation
Admin collateral account already exists
Creating user1 stablecoin account...
Creating user1 collateral account...
Creating user2 stablecoin account...
Creating user2 collateral account...
Skipping stablecoin minting - protocol will mint tokens during operations
Mint authority: 5oMxbgjPWkBYRKbsh3yKrrEC5Ut8y3azHKc787YHY9Ar, Admin: 5oMxbgjPWkBYRKbsh3yKrrEC5Ut8y3azHKc787YHY9Ar, Can mint: true
‚úÖ Minting collateral tokens for testing (localnet)...
‚úÖ Minted and distributed collateral tokens successfully
Creating token account for feeAddress1...
FeeAddress1: 8Lv4UrYHTrzvg9jPVVGNmxWyMrMvrZnCQLWucBzfJyyR
StablecoinMint: GnasBgv2aBS97fUDGXGcseCQcXT9tGoKG9R49SDDyMMM
FeeAddress1 token account already exists: GqY4SbdRG4vudGatbLN4d6yfnXXPzPrHDJBKWbgonxQq
FeeAddress2 token account already exists: Hn5V9cYLmZDPwXQcp4vc6VMDzVatpBZBmmwNGXDNj6Cq
Fee1 token account owner: TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
Expected fee1 owner: 8Lv4UrYHTrzvg9jPVVGNmxWyMrMvrZnCQLWucBzfJyyR
Match: false
Fee2 token account owner: TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
Expected fee2 owner: GcNwV1nA5bityjNYsWwPLHykpKuuhPzK1AQFBbrPopnX
Match: false
Token accounts created successfully
Oracle already initialized
Fees already initialized
Protocol already initialized
‚úÖ Protocol state has correct addresses
Skipping PDA token account creation (not allowed)
    Core Protocol Operations
SortedTrovesState account doesn't exist yet
üîç Debug - Account addresses being passed:
- oracleProgram: 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M
- oracleState: 483r4BkQvjCU3QkMdgaZLFAvk2XW9N6za2BmjPqHyVtN
- feesProgram: AHmGKukQky3mDHLmFyJYcEaFub69vp2QqeSW7EbVpJjZ
- feesState: EMbFnchCu4t8FgXNYht49MaigXQxToqTcDoSCuQ5x9f2
- Existing troves accounts: 0
‚úÖ Trove opened successfully
      ‚úî Should open a trove successfully (2604ms)
‚úÖ Minting additional collateral for add_collateral test...
‚úÖ Minted 15000000000 additional collateral tokens to user1
  User1 raw balance: 15000000000 units
  User1 UI balance: 15 tokens
  Required amount: 15000000000 units
  User1 raw balance: 15000000000 units
  Required amount: 15000000000 units
‚úÖ Collateral added successfully
      ‚úî Should add collateral to existing trove (5834ms)
‚úÖ Additional loan borrowed successfully
      ‚úî Should borrow additional loan from trove (2261ms)
Staking stablecoins from user1's trove...
‚úÖ Stablecoins staked successfully
      ‚úî Should stake stablecoins in stability pool (2248ms)
SortedTrovesState has 1 troves, head: GLThBB9YBHJgQMVj2wGpbLwKwEMfjr1ieVHaqgueYxUn
‚úì Processed trove GLThBB9YBHJgQMVj2wGpbLwKwEMfjr1ieVHaqgueYxUn, next: null
‚úÖ Fetched 1 valid trove accounts for traversal
‚úÖ Second trove opened successfully
      ‚úî Should open a second trove for user2 (3161ms)
‚úÖ Loan partially repaid successfully
      ‚úî Should repay loan partially (3033ms)
‚úÖ Collateral removed successfully
      ‚úî Should remove collateral from trove (3428ms)
‚úÖ Stablecoins unstaked successfully
      ‚úî Should unstake stablecoins from stability pool (2358ms)
    Protocol State Verification
üìä Protocol State:
- Total Debt Amount: 80749999948000000
- Total Collateral Amount: 0
- Total Stake Amount: 3000000000000000
- Minimum Collateral Ratio: 115
- Protocol Fee: 5
‚úÖ Protocol state verification passed
      ‚úî Should verify protocol state after operations (316ms)
üìä User1 Trove State:
- Owner: GLThBB9YBHJgQMVj2wGpbLwKwEMfjr1ieVHaqgueYxUn
- Debt Amount: 2944999998000000
- Collateral Amount: 24997000000
- Collateral Denom: SOL
‚úÖ User trove verification passed
      ‚úî Should verify user trove state (910ms)
üìä User1 Stake State:
- Owner: GLThBB9YBHJgQMVj2wGpbLwKwEMfjr1ieVHaqgueYxUn
- Amount: 0
- P Snapshot: 1000000000000000000
- Epoch Snapshot: 0
‚úÖ User stake verification passed
      ‚úî Should verify user stake state (627ms)


  11 passing (57s)

taha@HP-Probook:~/Documents/Projects/Aeroscraper/aerospacer-solana$ 