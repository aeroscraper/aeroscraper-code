
taha@HP-Probook:~/Documents/Projects/Aeroscraper/aerospacer-solana$ ANCHOR_PROVIDER_URL=https://devnet.helius-rpc.com/?api-key=e153d2eb-e16c-4b9d-a369-c418cfff8e13 ANCHOR_WALLET=~/.config/solana/id.json npx ts-mocha -p ./tsconfig.json -t 1000000 'tests/**/protocol-core.ts'
(node:1195163) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/tests/protocol-core.ts is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)


  Aeroscraper Protocol Core Operations
Using existing stablecoin mint: GnasBgv2aBS97fUDGXGcseCQcXT9tGoKG9R49SDDyMMM
‚úÖ Using existing devnet collateral mint from vault: Hygyfy8RBxLvoz5b3ffsg9PAvEkT3BJXXdTpVu6ftZYz
Creating admin stablecoin account...
Admin public key: 5oMxbgjPWkBYRKbsh3yKrrEC5Ut8y3azHKc787YHY9Ar
Stablecoin mint: GnasBgv2aBS97fUDGXGcseCQcXT9tGoKG9R49SDDyMMM
Admin stablecoin account already exists, skipping creation
Admin collateral account already exists
Creating user1 stablecoin account...
Creating user1 collateral account...
Creating user2 stablecoin account...
Creating user2 collateral account...
Skipping stablecoin minting - protocol will mint tokens during operations
Mint authority: 5oMxbgjPWkBYRKbsh3yKrrEC5Ut8y3azHKc787YHY9Ar, Admin: 5oMxbgjPWkBYRKbsh3yKrrEC5Ut8y3azHKc787YHY9Ar, Can mint: true
‚úÖ Minting collateral tokens for testing (localnet)...
‚úÖ Minted and distributed collateral tokens successfully
Creating token account for feeAddress1...
FeeAddress1: 8Lv4UrYHTrzvg9jPVVGNmxWyMrMvrZnCQLWucBzfJyyR
StablecoinMint: GnasBgv2aBS97fUDGXGcseCQcXT9tGoKG9R49SDDyMMM
FeeAddress1 token account already exists: GqY4SbdRG4vudGatbLN4d6yfnXXPzPrHDJBKWbgonxQq
FeeAddress2 token account already exists: Hn5V9cYLmZDPwXQcp4vc6VMDzVatpBZBmmwNGXDNj6Cq
Fee1 token account owner: TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
Expected fee1 owner: 8Lv4UrYHTrzvg9jPVVGNmxWyMrMvrZnCQLWucBzfJyyR
Match: false
Fee2 token account owner: TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA
Expected fee2 owner: GcNwV1nA5bityjNYsWwPLHykpKuuhPzK1AQFBbrPopnX
Match: false
Token accounts created successfully
Oracle already initialized
Fees already initialized
Protocol already initialized
‚úÖ Protocol state has correct addresses
Skipping PDA token account creation (not allowed)
    Core Protocol Operations
SortedTrovesState has 1 troves, head: Fi87B8eEqXG7dAkJCkoQhmfeQNNwdWeiZXCM2LVpPewQ
‚úì Processed trove Fi87B8eEqXG7dAkJCkoQhmfeQNNwdWeiZXCM2LVpPewQ, next: null
‚úÖ Fetched 1 trove accounts for traversal
üîç Debug - Account addresses being passed:
- oracleProgram: 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M
- oracleState: 483r4BkQvjCU3QkMdgaZLFAvk2XW9N6za2BmjPqHyVtN
- feesProgram: AHmGKukQky3mDHLmFyJYcEaFub69vp2QqeSW7EbVpJjZ
- feesState: EMbFnchCu4t8FgXNYht49MaigXQxToqTcDoSCuQ5x9f2
- Existing troves accounts: 2
‚ùå Trove opening failed: AnchorError: AnchorError caused by account: Node. Error Code: AccountDiscriminatorMismatch. Error Number: 3002. Error Message: Account discriminator did not match what was expected.
    at Function.parse (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:168:14)
    at translateError (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
    at MethodsBuilder.rpc [as _rpcFn] (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  errorLogs: [
    'Program log: AnchorError caused by account: Node. Error Code: AccountDiscriminatorMismatch. Error Number: 3002. Error Message: Account discriminator did not match what was expected.'
  ],
  logs: [
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ invoke [1]',
    'Program log: Instruction: OpenTrove',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program log: Opening fee: 55000000000000 aUSD (5%)',
    'Program log: Net loan amount: 1045000000000000 aUSD',
    'Program 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M invoke [2]',
    'Program log: Instruction: GetPrice',
    'Program log: Price query successful',
    'Program log: Denom: SOL',
    'Program log: Decimal: 9',
    'Program log: Publish Time: 1724967841',
    'Program log: Price: 13981741499 ¬± 3495500 x 10^-8',
    'Program log: Real Pyth data extracted successfully using official SDK',
    'Program 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M consumed 7304 of 140914 compute units',
    'Program return: 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M AwAAAFNPTLtxYEEDAAAACKHr0GYAAAAATFY1AAAAAAD4////',
    'Program 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M success',
    'Program log: Oracle CPI executed successfully for denom: SOL',
    'Program log: Price received: 13981741499 for SOL',
    'Program log: DEBUG - Collateral amount: 10000000000',
    'Program log: DEBUG - Price: 13981741499',
    'Program log: DEBUG - Price decimal: 8',
    'Program log: DEBUG - Calculated collateral value: 1398174149900',
    'Program log: DEBUG - Loan amount: 1045000000000000',
    'Program log: DEBUG - Calculated ICR: 133796569368',
    'Program log: DEBUG - Minimum ICR required: 115',
    'Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA invoke [2]',
    'Program log: Instruction: Transfer',
    'Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA consumed 4645 of 125811 compute units',
    'Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA success',
    'Program log: AnchorError caused by account: Node. Error Code: AccountDiscriminatorMismatch. Error Number: 3002. Error Message: Account discriminator did not match what was expected.',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ consumed 81714 of 200000 compute units',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ failed: custom program error: 0xbba'
  ],
  error: {
    errorCode: { code: 'AccountDiscriminatorMismatch', number: 3002 },
    errorMessage: 'Account discriminator did not match what was expected',
    comparedValues: undefined,
    origin: 'Node'
  },
  _programErrorStack: ProgramErrorStack {
    stack: [
      [PublicKey [PublicKey(9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ)]]
    ]
  }
}
      1) Should open a trove successfully
‚ùå Adding collateral failed: AnchorError: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
    at Function.parse (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:168:14)
    at translateError (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
    at MethodsBuilder.rpc [as _rpcFn] (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  errorLogs: [
    'Program log: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.'
  ],
  logs: [
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ invoke [1]',
    'Program log: Instruction: AddCollateral',
    'Program log: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ consumed 7295 of 200000 compute units',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ failed: custom program error: 0xbc4'
  ],
  error: {
    errorCode: { code: 'AccountNotInitialized', number: 3012 },
    errorMessage: 'The program expected this account to be already initialized',
    comparedValues: undefined,
    origin: 'user_debt_amount'
  },
  _programErrorStack: ProgramErrorStack {
    stack: [
      [PublicKey [PublicKey(9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ)]]
    ]
  }
}
      2) Should add collateral to existing trove
‚ùå Borrowing additional loan failed: AnchorError: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
    at Function.parse (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:168:14)
    at translateError (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
    at MethodsBuilder.rpc [as _rpcFn] (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  errorLogs: [
    'Program log: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.'
  ],
  logs: [
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ invoke [1]',
    'Program log: Instruction: BorrowLoan',
    'Program log: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ consumed 9416 of 200000 compute units',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ failed: custom program error: 0xbc4'
  ],
  error: {
    errorCode: { code: 'AccountNotInitialized', number: 3012 },
    errorMessage: 'The program expected this account to be already initialized',
    comparedValues: undefined,
    origin: 'user_debt_amount'
  },
  _programErrorStack: ProgramErrorStack {
    stack: [
      [PublicKey [PublicKey(9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ)]]
    ]
  }
}
      3) Should borrow additional loan from trove
Staking stablecoins from user1's trove...
‚ùå Staking failed: AnchorError: AnchorError thrown in programs/aerospacer-protocol/src/instructions/stake.rs:72. Error Code: InsufficientCollateral. Error Number: 6013. Error Message: Insufficient collateral.
    at Function.parse (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:152:14)
    at translateError (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
    at MethodsBuilder.rpc [as _rpcFn] (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  errorLogs: [
    'Program log: AnchorError thrown in programs/aerospacer-protocol/src/instructions/stake.rs:72. Error Code: InsufficientCollateral. Error Number: 6013. Error Message: Insufficient collateral.'
  ],
  logs: [
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ invoke [1]',
    'Program log: Instruction: Stake',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program log: AnchorError thrown in programs/aerospacer-protocol/src/instructions/stake.rs:72. Error Code: InsufficientCollateral. Error Number: 6013. Error Message: Insufficient collateral.',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ consumed 22063 of 200000 compute units',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ failed: custom program error: 0x177d'
  ],
  error: {
    errorCode: { code: 'InsufficientCollateral', number: 6013 },
    errorMessage: 'Insufficient collateral',
    comparedValues: undefined,
    origin: {
      file: 'programs/aerospacer-protocol/src/instructions/stake.rs',
      line: 72
    }
  },
  _programErrorStack: ProgramErrorStack {
    stack: [
      [PublicKey [PublicKey(9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ)]]
    ]
  }
}
      4) Should stake stablecoins in stability pool
SortedTrovesState has 1 troves, head: Fi87B8eEqXG7dAkJCkoQhmfeQNNwdWeiZXCM2LVpPewQ
‚úì Processed trove Fi87B8eEqXG7dAkJCkoQhmfeQNNwdWeiZXCM2LVpPewQ, next: null
‚úÖ Fetched 1 trove accounts for traversal
‚ùå Second trove opening failed: AnchorError: AnchorError caused by account: Node. Error Code: AccountDiscriminatorMismatch. Error Number: 3002. Error Message: Account discriminator did not match what was expected.
    at Function.parse (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:168:14)
    at translateError (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
    at MethodsBuilder.rpc [as _rpcFn] (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  errorLogs: [
    'Program log: AnchorError caused by account: Node. Error Code: AccountDiscriminatorMismatch. Error Number: 3002. Error Message: Account discriminator did not match what was expected.'
  ],
  logs: [
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ invoke [1]',
    'Program log: Instruction: OpenTrove',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program 11111111111111111111111111111111 invoke [2]',
    'Program 11111111111111111111111111111111 success',
    'Program log: Opening fee: 100000000000000 aUSD (5%)',
    'Program log: Net loan amount: 1900000000000000 aUSD',
    'Program 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M invoke [2]',
    'Program log: Instruction: GetPrice',
    'Program log: Price query successful',
    'Program log: Denom: SOL',
    'Program log: Decimal: 9',
    'Program log: Publish Time: 1724967841',
    'Program log: Price: 13981741499 ¬± 3495500 x 10^-8',
    'Program log: Real Pyth data extracted successfully using official SDK',
    'Program 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M consumed 7304 of 140902 compute units',
    'Program return: 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M AwAAAFNPTLtxYEEDAAAACKHr0GYAAAAATFY1AAAAAAD4////',
    'Program 8zG12srZdYaJPjWzCAJhwyxF7wWTz5spbmehxWpV5Q9M success',
    'Program log: Oracle CPI executed successfully for denom: SOL',
    'Program log: Price received: 13981741499 for SOL',
    'Program log: DEBUG - Collateral amount: 1000000',
    'Program log: DEBUG - Price: 13981741499',
    'Program log: DEBUG - Price decimal: 8',
    'Program log: DEBUG - Calculated collateral value: 139817414',
    'Program log: DEBUG - Loan amount: 1900000000000000',
    'Program log: DEBUG - Calculated ICR: 7358811',
    'Program log: DEBUG - Minimum ICR required: 115',
    'Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA invoke [2]',
    'Program log: Instruction: Transfer',
    'Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA consumed 4645 of 126010 compute units',
    'Program TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA success',
    'Program log: AnchorError caused by account: Node. Error Code: AccountDiscriminatorMismatch. Error Number: 3002. Error Message: Account discriminator did not match what was expected.',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ consumed 81515 of 200000 compute units',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ failed: custom program error: 0xbba'
  ],
  error: {
    errorCode: { code: 'AccountDiscriminatorMismatch', number: 3002 },
    errorMessage: 'Account discriminator did not match what was expected',
    comparedValues: undefined,
    origin: 'Node'
  },
  _programErrorStack: ProgramErrorStack {
    stack: [
      [PublicKey [PublicKey(9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ)]]
    ]
  }
}
      5) Should open a second trove for user2
‚ùå Loan repayment failed: AnchorError: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
    at Function.parse (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:168:14)
    at translateError (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
    at MethodsBuilder.rpc [as _rpcFn] (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  errorLogs: [
    'Program log: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.'
  ],
  logs: [
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ invoke [1]',
    'Program log: Instruction: RepayLoan',
    'Program log: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ consumed 7834 of 200000 compute units',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ failed: custom program error: 0xbc4'
  ],
  error: {
    errorCode: { code: 'AccountNotInitialized', number: 3012 },
    errorMessage: 'The program expected this account to be already initialized',
    comparedValues: undefined,
    origin: 'user_debt_amount'
  },
  _programErrorStack: ProgramErrorStack {
    stack: [
      [PublicKey [PublicKey(9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ)]]
    ]
  }
}
      6) Should repay loan partially
‚ùå Removing collateral failed: AnchorError: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
    at Function.parse (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:168:14)
    at translateError (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
    at MethodsBuilder.rpc [as _rpcFn] (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  errorLogs: [
    'Program log: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.'
  ],
  logs: [
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ invoke [1]',
    'Program log: Instruction: RemoveCollateral',
    'Program log: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ consumed 7298 of 200000 compute units',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ failed: custom program error: 0xbc4'
  ],
  error: {
    errorCode: { code: 'AccountNotInitialized', number: 3012 },
    errorMessage: 'The program expected this account to be already initialized',
    comparedValues: undefined,
    origin: 'user_debt_amount'
  },
  _programErrorStack: ProgramErrorStack {
    stack: [
      [PublicKey [PublicKey(9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ)]]
    ]
  }
}
      7) Should remove collateral from trove
‚ùå Unstaking failed: AnchorError: AnchorError caused by account: user_stake_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
    at Function.parse (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:168:14)
    at translateError (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/error.ts:277:35)
    at MethodsBuilder.rpc [as _rpcFn] (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  errorLogs: [
    'Program log: AnchorError caused by account: user_stake_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.'
  ],
  logs: [
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ invoke [1]',
    'Program log: Instruction: Unstake',
    'Program log: AnchorError caused by account: user_stake_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ consumed 4002 of 200000 compute units',
    'Program 9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ failed: custom program error: 0xbc4'
  ],
  error: {
    errorCode: { code: 'AccountNotInitialized', number: 3012 },
    errorMessage: 'The program expected this account to be already initialized',
    comparedValues: undefined,
    origin: 'user_stake_amount'
  },
  _programErrorStack: ProgramErrorStack {
    stack: [
      [PublicKey [PublicKey(9sk8X11GWtZjzXWfkcLMRD6tmuhmiBKgMXsmx9bEh5YQ)]]
    ]
  }
}
      8) Should unstake stablecoins from stability pool
    Protocol State Verification
üìä Protocol State:
- Total Debt Amount: 1044999998000000
- Total Collateral Amount: 0
- Total Stake Amount: 0
- Minimum Collateral Ratio: 115
- Protocol Fee: 5
‚ùå Protocol state verification failed: AssertionError: Total stake should be greater than 0
    at /home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/tests/protocol-core.ts:963:15
    at Generator.next (<anonymous>)
    at fulfilled (/home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/tests/protocol-core.ts:38:58)
    at processTicksAndRejections (node:internal/process/task_queues:105:5) {
  showDiff: false,
  actual: null,
  expected: undefined,
  operator: 'strictEqual'
}
      9) Should verify protocol state after operations
‚ö†Ô∏è  User debt account does not exist - skipping verification
      ‚úî Should verify user trove state (1136ms)
‚ö†Ô∏è  User stake account does not exist - skipping verification
      ‚úî Should verify user stake state (919ms)


  2 passing (1m)
  9 failing

  1) Aeroscraper Protocol Core Operations
       Core Protocol Operations
         Should open a trove successfully:
     Error: AnchorError caused by account: Node. Error Code: AccountDiscriminatorMismatch. Error Number: 3002. Error Message: Account discriminator did not match what was expected.
      at Function.parse (node_modules/@coral-xyz/anchor/src/error.ts:168:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  2) Aeroscraper Protocol Core Operations
       Core Protocol Operations
         Should add collateral to existing trove:
     Error: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
      at Function.parse (node_modules/@coral-xyz/anchor/src/error.ts:168:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  3) Aeroscraper Protocol Core Operations
       Core Protocol Operations
         Should borrow additional loan from trove:
     Error: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
      at Function.parse (node_modules/@coral-xyz/anchor/src/error.ts:168:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  4) Aeroscraper Protocol Core Operations
       Core Protocol Operations
         Should stake stablecoins in stability pool:
     Error: AnchorError thrown in programs/aerospacer-protocol/src/instructions/stake.rs:72. Error Code: InsufficientCollateral. Error Number: 6013. Error Message: Insufficient collateral.
      at Function.parse (node_modules/@coral-xyz/anchor/src/error.ts:152:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  5) Aeroscraper Protocol Core Operations
       Core Protocol Operations
         Should open a second trove for user2:
     Error: AnchorError caused by account: Node. Error Code: AccountDiscriminatorMismatch. Error Number: 3002. Error Message: Account discriminator did not match what was expected.
      at Function.parse (node_modules/@coral-xyz/anchor/src/error.ts:168:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  6) Aeroscraper Protocol Core Operations
       Core Protocol Operations
         Should repay loan partially:
     Error: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
      at Function.parse (node_modules/@coral-xyz/anchor/src/error.ts:168:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  7) Aeroscraper Protocol Core Operations
       Core Protocol Operations
         Should remove collateral from trove:
     Error: AnchorError caused by account: user_debt_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
      at Function.parse (node_modules/@coral-xyz/anchor/src/error.ts:168:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  8) Aeroscraper Protocol Core Operations
       Core Protocol Operations
         Should unstake stablecoins from stability pool:
     Error: AnchorError caused by account: user_stake_amount. Error Code: AccountNotInitialized. Error Number: 3012. Error Message: The program expected this account to be already initialized.
      at Function.parse (node_modules/@coral-xyz/anchor/src/error.ts:168:14)
      at translateError (node_modules/@coral-xyz/anchor/src/error.ts:277:35)
      at MethodsBuilder.rpc [as _rpcFn] (node_modules/@coral-xyz/anchor/src/program/namespace/rpc.ts:35:29)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)

  9) Aeroscraper Protocol Core Operations
       Protocol State Verification
         Should verify protocol state after operations:
     AssertionError: Total stake should be greater than 0
      at /home/taha/Documents/Projects/Aeroscraper/aerospacer-solana/tests/protocol-core.ts:963:15
      at Generator.next (<anonymous>)
      at fulfilled (tests/protocol-core.ts:38:58)
      at processTicksAndRejections (node:internal/process/task_queues:105:5)


